<div class="admin-dashboard">
  <!-- Header -->
  <div class="dashboard-header">
    <div class="header-content">
      <h1>Admin Dashboard</h1>
      <div class="header-actions">
        <button class="btn btn-refresh" (click)="refresh()" [disabled]="isLoading">
          <span class="icon">üîÑ</span>
          <span>Refresh</span>
        </button>
        <button class="btn btn-alerts" (click)="toggleAlertsPanel()" [class.has-alerts]="totalAlerts > 0">
          <span class="icon">üîî</span>
          <span>Alerts</span>
          <span class="badge" *ngIf="totalAlerts > 0">{{ totalAlerts }}</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Error Message -->
  <div class="alert alert-danger" *ngIf="error">
    <strong>Error:</strong> {{ error }}
    <button class="btn-close" (click)="error = null">√ó</button>
  </div>

  <!-- System Alerts Panel -->
  <div class="alerts-panel" *ngIf="showAlertsPanel && systemAlerts.length > 0">
    <div class="alerts-header">
      <h3>System Alerts</h3>
      <button class="btn-close" (click)="toggleAlertsPanel()">√ó</button>
    </div>
    <div class="alerts-list">
      <div *ngFor="let alert of systemAlerts" [class]="'alert ' + getAlertClass(alert.type)">
        <div class="alert-content">
          <strong>{{ alert.category | titlecase }}:</strong> {{ alert.message }}
          <span class="badge" *ngIf="alert.count">{{ alert.count }}</span>
        </div>
        <button class="btn-dismiss" (click)="dismissAlert(alert)">√ó</button>
      </div>
    </div>
  </div>

  <!-- Loading State (Only show on initial load) -->
  <div class="loading-overlay" *ngIf="loading.stats && !dashboardStats">
    <div class="spinner"></div>
    <p>Loading dashboard...</p>
  </div>

  <!-- Main Content -->
  <div class="dashboard-content" *ngIf="hasData">

    <!-- Navigation Tabs -->
    <div class="dashboard-tabs">
      <button class="tab-button" [class.active]="selectedTab === 'overview'" (click)="selectTab('overview')">
        Overview
      </button>
      <button class="tab-button" [class.active]="selectedTab === 'analytics'" (click)="selectTab('analytics')">
        Analytics
      </button>
      <button class="tab-button" [class.active]="selectedTab === 'products'" (click)="selectTab('products')">
        Products
      </button>
      <button class="tab-button" [class.active]="selectedTab === 'orders'" (click)="selectTab('orders')">
        Orders
      </button>
      <button class="tab-button" [class.active]="selectedTab === 'users'" (click)="selectTab('users')">
        Users
      </button>
    </div>

    <!-- Overview Tab -->
    <div class="tab-content" *ngIf="selectedTab === 'overview'">

      <!-- Stats Cards -->
      <div class="stats-grid">
        <!-- Users Card -->
        <div class="stat-card">
          <div class="stat-icon users">üë•</div>
          <div class="stat-content">
            <h3>Total Users</h3>
            <p class="stat-number">{{ dashboardStats?.users?.total || 0 }}</p>
            <div class="stat-details">
              <span>Customers: {{ dashboardStats?.users?.customers || 0 }}</span>
              <span>Sellers: {{ dashboardStats?.users?.sellers || 0 }}</span>
            </div>
            <div class="stat-growth">
              <span class="growth-badge positive">
                +{{ dashboardStats?.users?.newLast30Days || 0 }} this month
              </span>
            </div>
          </div>
        </div>

        <!-- Products Card -->
        <div class="stat-card">
          <div class="stat-icon products">üì¶</div>
          <div class="stat-content">
            <h3>Total Products</h3>
            <p class="stat-number">{{ dashboardStats?.products?.total || 0 }}</p>
            <div class="stat-details">
              <span>In Stock: {{ dashboardStats?.products?.inStock || 0 }}</span>
              <span>Out of Stock: {{ dashboardStats?.products?.outOfStock || 0 }}</span>
            </div>
            <div class="stat-warning" *ngIf="dashboardStats?.products?.lowStock > 0">
              <span class="warning-badge">
                ‚ö†Ô∏è {{ dashboardStats?.products?.lowStock }} low stock
              </span>
            </div>
          </div>
        </div>

        <!-- Orders Card -->
        <div class="stat-card">
          <div class="stat-icon orders">üõí</div>
          <div class="stat-content">
            <h3>Total Orders</h3>
            <p class="stat-number">{{ dashboardStats?.orders?.total || 0 }}</p>
            <div class="stat-details">
              <span>Pending: {{ dashboardStats?.orders?.pending || 0 }}</span>
              <span>Processing: {{ dashboardStats?.orders?.processing || 0 }}</span>
            </div>
            <div class="stat-growth">
              <span class="growth-badge positive">
                +{{ dashboardStats?.orders?.last7Days || 0 }} this week
              </span>
            </div>
          </div>
        </div>

        <!-- Revenue Card -->
        <div class="stat-card highlight">
          <div class="stat-icon revenue">üí∞</div>
          <div class="stat-content">
            <h3>Total Revenue</h3>
            <p class="stat-number">{{ formatCurrency(dashboardStats?.revenue?.total || 0) }}</p>
            <div class="stat-details">
              <span>Last 30 Days: {{ formatCurrency(dashboardStats?.revenue?.last30Days || 0) }}</span>
              <span>Avg Order: {{ formatCurrency(dashboardStats?.revenue?.averageOrderValue || 0) }}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Quick Actions & Recent Activity -->
      <div class="two-column-layout">

        <!-- Recent Orders -->
        <div class="card">
          <div class="card-header">
            <h3>Recent Orders</h3>
            <a routerLink="/orders" class="btn-link">View All ‚Üí</a>
          </div>
          <div class="card-body">
            <div *ngIf="loading.orders" class="loading">Loading...</div>
            <div *ngIf="!loading.orders && (!recentOrders || recentOrders.length === 0)" class="empty-state">
              No recent orders found. Orders will appear here once customers start placing orders.
            </div>
            <div class="orders-list" *ngIf="!loading.orders && recentOrders && recentOrders.length > 0">
              <div class="order-item" *ngFor="let order of recentOrders">
                <div class="order-info">
                  <strong>{{ order.customerName || 'Unknown Customer' }}</strong>
                  <span class="order-id">#{{ order.orderId || 'N/A' }}</span>
                </div>
                <div class="order-meta">
                  <span class="order-amount">{{ formatCurrency(order.totalAmount || 0) }}</span>
                  <span [class]="'badge ' + getStatusBadgeClass(order.status || 'pending')">
                    {{ order.status || 'pending' }}
                  </span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Low Stock Alerts -->
        <div class="card">
          <div class="card-header">
            <h3>Low Stock Products</h3>
            <a routerLink="/products" class="btn-link">View All ‚Üí</a>
          </div>
          <div class="card-body">
            <div *ngIf="loading.lowStock" class="loading">Loading...</div>
            <div *ngIf="!loading.lowStock && (!lowStockProducts || lowStockProducts.length === 0)"
              class="empty-state success">
              ‚úì All products are well-stocked!
            </div>
            <div class="stock-list" *ngIf="!loading.lowStock && lowStockProducts && lowStockProducts.length > 0">
              <div class="stock-item" *ngFor="let product of lowStockProducts">
                <div class="stock-info">
                  <strong>{{ product.title || 'Unknown Product' }}</strong>
                  <span class="category">{{ product.categoryName || 'Uncategorized' }}</span>
                </div>
                <div class="stock-level">
                  <span class="stock-badge warning">{{ product.stock || 0 }} left</span>
                  <span class="seller">by {{ product.sellerName || 'Unknown Seller' }}</span>
                </div>
              </div>
            </div>
          </div>
        </div>

      </div>
    </div>

    <!-- Analytics Tab -->
    <div class="tab-content" *ngIf="selectedTab === 'analytics'">

      <!-- Revenue Chart -->
      <div class="card">
        <div class="card-header">
          <h3>Revenue Trends (Last 6 Months)</h3>
        </div>
        <div class="card-body">
          <div *ngIf="loading.revenue" class="loading">Loading chart...</div>
          <div *ngIf="!loading.revenue && revenueChart" class="chart-container">
            <div class="simple-chart">
              <div class="chart-bars">
                <div class="chart-bar" *ngFor="let value of revenueChart.values; let i = index"
                  [style.height.%]="(value / getMaxValue(revenueChart.values)) * 100"
                  [title]="revenueChart.labels[i] + ': ' + formatCurrency(value)">
                  <span class="bar-label">{{ formatCurrency(value) }}</span>
                </div>
              </div>
              <div class="chart-labels">
                <span *ngFor="let label of revenueChart.labels">{{ label }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Performance Metrics -->
      <div class="metrics-grid">

        <!-- Top Products -->
        <div class="card">
          <div class="card-header">
            <h3>Top Products</h3>
          </div>
          <div class="card-body">
            <div *ngIf="loading.products" class="loading">Loading...</div>
            <div *ngIf="!loading.products && (!topProducts || topProducts.length === 0)" class="empty-state">
              No product sales data available yet.
            </div>
            <div class="ranking-list" *ngIf="!loading.products && topProducts && topProducts.length > 0">
              <div class="ranking-item" *ngFor="let product of topProducts.slice(0, 5); let i = index">
                <span class="rank">{{ i + 1 }}</span>
                <div class="item-info">
                  <strong>{{ product.title || 'Unknown Product' }}</strong>
                  <span class="meta">
                    {{ product.unitsSold || 0 }} units sold
                    <span *ngIf="product.categoryName"> ‚Ä¢ {{ product.categoryName }}</span>
                  </span>
                </div>
                <span class="value">{{ formatCurrency(product.revenue || 0) }}</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Top Customers -->
        <div class="card">
          <div class="card-header">
            <h3>Top Customers</h3>
          </div>
          <div class="card-body">
            <div *ngIf="loading.customers" class="loading">Loading...</div>
            <div *ngIf="!loading.customers && (!topCustomers || topCustomers.length === 0)" class="empty-state">
              No customer purchase data available yet.
            </div>
            <div class="ranking-list" *ngIf="!loading.customers && topCustomers && topCustomers.length > 0">
              <div class="ranking-item" *ngFor="let customer of topCustomers.slice(0, 5); let i = index">
                <span class="rank">{{ i + 1 }}</span>
                <div class="item-info">
                  <strong>{{ customer.name || 'Unknown Customer' }}</strong>
                  <span class="meta">
                    {{ customer.totalOrders || 0 }} orders
                    <span *ngIf="customer.email"> ‚Ä¢ {{ customer.email }}</span>
                  </span>
                </div>
                <span class="value">{{ formatCurrency(customer.totalSpent || 0) }}</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Category Performance -->
        <div class="card full-width">
          <div class="card-header">
            <h3>Category Performance</h3>
          </div>
          <div class="card-body">
            <div *ngIf="loading.categories" class="loading">Loading...</div>
            <div class="category-grid"
              *ngIf="!loading.categories && categoryPerformance && categoryPerformance.length > 0">
              <div class="category-card" *ngFor="let category of categoryPerformance">
                <h4>{{ category.categoryName }}</h4>
                <div class="category-stats">
                  <div class="stat">
                    <span class="label">Products:</span>
                    <span class="value">{{ category.productCount }}</span>
                  </div>
                  <div class="stat">
                    <span class="label">Sales:</span>
                    <span class="value">{{ category.unitsSold }}</span>
                  </div>
                  <div class="stat">
                    <span class="label">Revenue:</span>
                    <span class="value">{{ formatCurrency(category.revenue) }}</span>
                  </div>
                  <div class="stat">
                    <span class="label">Rating:</span>
                    <span class="value rating">{{ getRatingStars(category.averageRating) }}</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

      </div>
    </div>

    <!-- Products Tab -->
    <div class="tab-content" *ngIf="selectedTab === 'products'">
      <div class="card">
        <div class="card-header">
          <h3>Product Management</h3>
          <button class="btn btn-primary" (click)="openProductManagement()">Full Management</button>
        </div>
        <div class="card-body">
          <div class="stats-row">
            <div class="stat-box">
              <span class="label">Total Products</span>
              <span class="value">{{ dashboardStats?.products?.total || 0 }}</span>
            </div>
            <div class="stat-box">
              <span class="label">In Stock</span>
              <span class="value">{{ dashboardStats?.products?.inStock || 0 }}</span>
            </div>
            <div class="stat-box">
              <span class="label">Low Stock</span>
              <span class="value warning">{{ dashboardStats?.products?.lowStock || 0 }}</span>
            </div>
            <div class="stat-box">
              <span class="label">Out of Stock</span>
              <span class="value danger">{{ dashboardStats?.products?.outOfStock || 0 }}</span>
            </div>
          </div>

          <div class="section-divider"></div>

          <h4>Top Selling Products</h4>
          <div *ngIf="!topProducts || topProducts.length === 0" class="empty-state">
            No product data available yet.
          </div>
          <div class="products-table" *ngIf="topProducts && topProducts.length > 0">
            <table>
              <thead>
                <tr>
                  <th>Rank</th>
                  <th>Product</th>
                  <th>Category</th>
                  <th>Stock</th>
                  <th>Units Sold</th>
                  <th>Revenue</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let product of topProducts; let i = index">
                  <td>{{ i + 1 }}</td>
                  <td><strong>{{ product.title }}</strong></td>
                  <td>{{ product.categoryName }}</td>
                  <td>
                    <span [class.text-warning]="product.stock < 10" [class.text-danger]="product.stock === 0">
                      {{ product.stock }}
                    </span>
                  </td>
                  <td>{{ product.unitsSold || 0 }}</td>
                  <td>{{ formatCurrency(product.revenue) }}</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- Orders Tab -->
    <div class="tab-content" *ngIf="selectedTab === 'orders'">
      <div class="card">
        <div class="card-header">
          <h3>Order Management</h3>
          <button class="btn btn-primary" (click)="openOrderManagement()">Full Management</button>
        </div>
        <div class="card-body">
          <div class="stats-row">
            <div class="stat-box">
              <span class="label">Total Orders</span>
              <span class="value">{{ dashboardStats?.orders?.total || 0 }}</span>
            </div>
            <div class="stat-box">
              <span class="label">Pending</span>
              <span class="value warning">{{ dashboardStats?.orders?.pending || 0 }}</span>
            </div>
            <div class="stat-box">
              <span class="label">Processing</span>
              <span class="value">{{ dashboardStats?.orders?.processing || 0 }}</span>
            </div>
            <div class="stat-box">
              <span class="label">Delivered</span>
              <span class="value success">{{ dashboardStats?.orders?.delivered || 0 }}</span>
            </div>
          </div>

          <div class="section-divider"></div>

          <h4>Recent Orders</h4>
          <div *ngIf="!recentOrders || recentOrders.length === 0" class="empty-state">
            No orders available. Orders will appear here once customers start placing orders.
          </div>
          <div class="orders-table" *ngIf="recentOrders && recentOrders.length > 0">
            <table>
              <thead>
                <tr>
                  <th>Order ID</th>
                  <th>Customer</th>
                  <th>Amount</th>
                  <th>Status</th>
                  <th>Date</th>
                  <th>Items</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let order of recentOrders.slice(0, 10)">
                  <td>#{{ order.orderId || 'N/A' }}</td>
                  <td>{{ order.customerName || 'Unknown' }}</td>
                  <td>{{ formatCurrency(order.totalAmount || 0) }}</td>
                  <td>
                    <span [class]="'badge ' + getStatusBadgeClass(order.status || 'pending')">
                      {{ order.status || 'pending' }}
                    </span>
                  </td>
                  <td>{{ formatDate(order.createdAt) }}</td>
                  <td>{{ order.itemCount || 0 }}</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- Users Tab -->
    <div class="tab-content" *ngIf="selectedTab === 'users'">
      <div class="card">
        <div class="card-header">
          <h3>User Management</h3>
          <button class="btn btn-primary" (click)="openUserManagement()">Full Management</button>
        </div>
        <div class="card-body">
          <div class="stats-row">
            <div class="stat-box">
              <span class="label">Total Users</span>
              <span class="value">{{ dashboardStats?.users?.total || 0 }}</span>
            </div>
            <div class="stat-box">
              <span class="label">Customers</span>
              <span class="value">{{ dashboardStats?.users?.customers || 0 }}</span>
            </div>
            <div class="stat-box">
              <span class="label">Sellers</span>
              <span class="value">{{ dashboardStats?.users?.sellers || 0 }}</span>
            </div>
            <div class="stat-box">
              <span class="label">New (30 days)</span>
              <span class="value success">+{{ dashboardStats?.users?.newLast30Days || 0 }}</span>
            </div>
          </div>

          <div class="section-divider"></div>

          <h4>Recent Users</h4>
          <div *ngIf="!recentUsers || recentUsers.length === 0" class="empty-state">
            No users found. Users will appear here after registration.
          </div>
          <div class="users-table" *ngIf="recentUsers && recentUsers.length > 0">
            <table>
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Email</th>
                  <th>Role</th>
                  <th>Orders</th>
                  <th>Total Spent</th>
                  <th>Joined</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let user of recentUsers.slice(0, 10)">
                  <td><strong>{{ user.name || 'Unknown' }}</strong></td>
                  <td>{{ user.email || 'N/A' }}</td>
                  <td>
                    <span class="badge badge-info">{{ user.role || 'customer' }}</span>
                  </td>
                  <td>{{ user.orderCount || 0 }}</td>
                  <td>{{ formatCurrency(user.totalSpent || 0) }}</td>
                  <td>{{ formatDate(user.createdAt) }}</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

  </div>

  <!-- No Data State -->
  <div class="empty-state-large" *ngIf="!hasData && !loading.stats && !error">
    <div class="empty-icon">üìä</div>
    <h2>No Dashboard Data</h2>
    <p>Unable to load dashboard statistics</p>
    <button class="btn btn-primary" (click)="refresh()">Try Again</button>
  </div>
</div>

<!-- USER MANAGEMENT MODAL -->
<div class="modal-overlay" *ngIf="showUserManagement" (click)="closeUserManagement()">
  <div class="modal-content large" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>üë• User Management</h2>
      <button class="btn-close" (click)="closeUserManagement()">√ó</button>
    </div>

    <div class="modal-body">
      <!-- Filters and Search -->
      <div class="toolbar">
        <div class="search-box">
          <input type="text" [(ngModel)]="userSearchTerm" placeholder="üîç Search by name or email..."
            class="search-input">
        </div>
        <select [(ngModel)]="userRoleFilter" class="filter-select">
          <option value="all">All Roles</option>
          <option value="admin">Admin</option>
          <option value="seller">Seller</option>
          <option value="customer">Customer</option>
        </select>
        <button class="btn btn-danger" (click)="bulkDeleteUsers()" [disabled]="selectedUserIds.length === 0">
          üóëÔ∏è Delete Selected ({{ selectedUserIds.length }})
        </button>
      </div>

      <!-- Users Table -->
      <div class="management-table">
        <table>
          <thead>
            <tr>
              <th width="40px">
                <input type="checkbox" (change)="toggleAllUsers($event)">
              </th>
              <th>Name</th>
              <th>Email</th>
              <th>Role</th>
              <th>Orders</th>
              <th>Spent</th>
              <th>Joined</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let user of filteredUsers">
              <td>
                <input type="checkbox" [checked]="selectedUserIds.includes(user.userId)"
                  (change)="toggleUserSelection(user.userId)">
              </td>
              <td><strong>{{ user.name }}</strong></td>
              <td>{{ user.email }}</td>
              <td>
                <select [value]="user.role" (change)="changeUserRole(user.userId, $any($event.target).value)"
                  class="role-select">
                  <option value="admin">Admin</option>
                  <option value="seller">Seller</option>
                  <option value="customer">Customer</option>
                  <option value="guest">Guest</option>
                </select>
              </td>
              <td>{{ user.orderCount || 0 }}</td>
              <td>{{ formatCurrency(user.totalSpent || 0) }}</td>
              <td>{{ formatDate(user.createdAt) }}</td>
              <td>
                <div class="action-buttons">
                  <button class="btn-icon btn-edit" (click)="editUser(user)" title="Edit">‚úèÔ∏è</button>
                  <button class="btn-icon btn-delete" (click)="deleteUser(user.userId)" title="Delete">üóëÔ∏è</button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="modal-footer">
        <p>Total: {{ filteredUsers.length }} users</p>
      </div>
    </div>
  </div>
</div>

<!-- ORDER MANAGEMENT MODAL -->
<div class="modal-overlay" *ngIf="showOrderManagement" (click)="closeOrderManagement()">
  <div class="modal-content large" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>üõí Order Management</h2>
      <button class="btn-close" (click)="closeOrderManagement()">√ó</button>
    </div>

    <div class="modal-body">
      <!-- Filters and Search -->
      <div class="toolbar">
        <div class="search-box">
          <input type="text" [(ngModel)]="orderSearchTerm" placeholder="üîç Search by order ID or customer..."
            class="search-input">
        </div>
        <select [(ngModel)]="orderStatusFilter" class="filter-select">
          <option value="all">All Status</option>
          <option value="pending">Pending</option>
          <option value="processing">Processing</option>
          <option value="shipped">Shipped</option>
          <option value="delivered">Delivered</option>
          <option value="cancelled">Cancelled</option>
        </select>
        <div class="bulk-actions">
          <button class="btn btn-info" (click)="bulkUpdateOrderStatus('processing')"
            [disabled]="selectedOrderIds.length === 0">
            Mark as Processing
          </button>
          <button class="btn btn-success" (click)="bulkUpdateOrderStatus('shipped')"
            [disabled]="selectedOrderIds.length === 0">
            Mark as Shipped
          </button>
        </div>
      </div>

      <!-- Orders Table -->
      <div class="management-table">
        <table>
          <thead>
            <tr>
              <th width="40px">
                <input type="checkbox" (change)="toggleAllOrders($event)">
              </th>
              <th>Order ID</th>
              <th>Customer</th>
              <th>Amount</th>
              <th>Status</th>
              <th>Date</th>
              <th>Items</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let order of filteredOrders">
              <td>
                <input type="checkbox" [checked]="selectedOrderIds.includes(order.orderId)"
                  (change)="toggleOrderSelection(order.orderId)">
              </td>
              <td><strong>#{{ order.orderId }}</strong></td>
              <td>{{ order.customerName }}</td>
              <td>{{ formatCurrency(order.totalAmount) }}</td>
              <td>
                <select [value]="order.status"
                  (change)="updateOrderStatus(order.orderId, $any($event.target).value)"
                  class="status-select">
                  <option value="pending">Pending</option>
                  <option value="processing">Processing</option>
                  <option value="shipped">Shipped</option>
                  <option value="delivered">Delivered</option>
                  <option value="cancelled">Cancelled</option>
                  <option value="failed">Failed</option>
                </select>
              </td>
              <td>{{ formatDate(order.createdAt) }}</td>
              <td>{{ order.itemCount }}</td>
              <td>
                <div class="action-buttons">
                  <button class="btn-icon btn-view" (click)="viewOrderDetails(order.orderId)" title="View">üëÅÔ∏è</button>
                  <button class="btn-icon btn-delete" (click)="deleteOrder(order.orderId)" title="Delete">üóëÔ∏è</button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="modal-footer">
        <p>Total: {{ filteredOrders.length }} orders | Selected: {{ selectedOrderIds.length }}</p>
      </div>
    </div>
  </div>
</div>

<!-- PRODUCT MANAGEMENT MODAL -->
<div class="modal-overlay" *ngIf="showProductManagement" (click)="closeProductManagement()">
  <div class="modal-content large" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>üì¶ Product Management</h2>
      <button class="btn-close" (click)="closeProductManagement()">√ó</button>
    </div>

    <div class="modal-body">
      <!-- Search and Actions -->
      <div class="toolbar">
        <div class="search-box">
          <input type="text" [(ngModel)]="productSearchTerm" placeholder="üîç Search products..." class="search-input">
        </div>
        <button class="btn btn-danger" (click)="bulkDeleteProducts()" [disabled]="selectedProductIds.length === 0">
          üóëÔ∏è Delete Selected ({{ selectedProductIds.length }})
        </button>
      </div>

      <!-- Products Table -->
      <div class="management-table">
        <table>
          <thead>
            <tr>
              <th width="40px">
                <input type="checkbox" (change)="toggleAllProducts($event)">
              </th>
              <th>Product</th>
              <th>Category</th>
              <th>Price</th>
              <th>Stock</th>
              <th>Sales</th>
              <th>Revenue</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let product of filteredProducts">
              <td>
                <input type="checkbox" [checked]="selectedProductIds.includes(product.productId)"
                  (change)="toggleProductSelection(product.productId)">
              </td>
              <td><strong>{{ product.title }}</strong></td>
              <td>{{ product.categoryName }}</td>
              <td>{{ formatCurrency(product.price || 0) }}</td>
              <td>
                <input type="number" [value]="product.stock"
                  (change)="updateProductStock(product.productId, $any($event.target).value)" class="stock-input"
                  min="0" style="width: 60px;">
              </td>
              <td>{{ product.unitsSold || 0 }}</td>
              <td>{{ formatCurrency(product.revenue || 0) }}</td>
              <td>
                <div class="action-buttons">
                  <button class="btn-icon btn-view" (click)="viewProductDetails(product.productId)"
                    title="View">üëÅÔ∏è</button>
                  <button class="btn-icon btn-delete" (click)="deleteProduct(product.productId)"
                    title="Delete">üóëÔ∏è</button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="modal-footer">
        <p>Total: {{ filteredProducts.length }} products | Selected: {{ selectedProductIds.length }}</p>
      </div>
    </div>
  </div>
</div>