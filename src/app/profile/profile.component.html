<!-- Header Navigation -->
<app-header></app-header>

<!-- Loading State -->
<div *ngIf="isLoading" class="loading-container">
    <div class="spinner"></div>
    <p>Loading your profile...</p>
</div>

<!-- Error State -->
<div *ngIf="error && !isLoading" class="error-container">
    <p>{{ error }}</p>
    <button (click)="loadUserData()" class="retry-btn">Retry</button>
</div>

<!-- Main Profile Content -->
<main class="profile-container" *ngIf="!isLoading && !error && user">
    <!-- Welcome Banner -->
    <div class="welcome-banner">
        <div class="container">
            <h1>Welcome back, {{ user.name }}!</h1>
            <p>{{ user.email }}</p>
        </div>
    </div>

    <div class="container profile-content">
        <!-- Sidebar Navigation -->
        <aside class="sidebar">
            <!-- Profile Card -->
            <div class="profile-card">
                <div class="avatar">{{ getUserInitials() }}</div>
                <h3>{{ user.name }}</h3>
                <p>{{ user.email }}</p>
                <p class="joined">Member since {{ getMemberSince() }}</p>
            </div>

            <!-- Navigation -->
            <nav class="profile-nav">
                <a (click)="setActiveSection('overview')" [class.active]="activeSection === 'overview'"
                    class="nav-item">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                        <rect x="3" y="3" width="7" height="7" rx="1" stroke="currentColor" stroke-width="2" />
                        <rect x="14" y="3" width="7" height="7" rx="1" stroke="currentColor" stroke-width="2" />
                        <rect x="14" y="14" width="7" height="7" rx="1" stroke="currentColor" stroke-width="2" />
                        <rect x="3" y="14" width="7" height="7" rx="1" stroke="currentColor" stroke-width="2" />
                    </svg>
                    Dashboard
                </a>
                <a (click)="setActiveSection('orders')" [class.active]="activeSection === 'orders'" class="nav-item">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                        <path
                            d="M9 5H7C5.89543 5 5 5.89543 5 7V19C5 20.1046 5.89543 21 7 21H17C18.1046 21 19 20.1046 19 19V7C19 5.89543 18.1046 5 17 5H15"
                            stroke="currentColor" stroke-width="2" />
                        <path d="M12 12H15" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                        <circle cx="9" cy="12" r="1" fill="currentColor" />
                    </svg>
                    My Orders
                </a>
                <a (click)="setActiveSection('addresses')" [class.active]="activeSection === 'addresses'"
                    class="nav-item">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                        <path
                            d="M21 10C21 17 12 23 12 23C12 23 3 17 3 10C3 7.61305 3.94821 5.32387 5.63604 3.63604C7.32387 1.94821 9.61305 1 12 1C14.3869 1 16.6761 1.94821 18.364 3.63604C20.0518 5.32387 21 7.61305 21 10Z"
                            stroke="currentColor" stroke-width="2" />
                        <circle cx="12" cy="10" r="3" stroke="currentColor" stroke-width="2" />
                    </svg>
                    Addresses
                </a>
                <a (click)="setActiveSection('payments')" [class.active]="activeSection === 'payments'"
                    class="nav-item">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                        <rect x="2" y="5" width="20" height="14" rx="2" stroke="currentColor" stroke-width="2" />
                        <path d="M2 10H22" stroke="currentColor" stroke-width="2" />
                    </svg>
                    Payment History
                </a>
                <a (click)="setActiveSection('settings')" [class.active]="activeSection === 'settings'"
                    class="nav-item">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                        <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2" />
                        <path
                            d="M12 1V3M12 21V23M4.22 4.22L5.64 5.64M18.36 18.36L19.78 19.78M1 12H3M21 12H23M4.22 19.78L5.64 18.36M18.36 5.64L19.78 4.22"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                    </svg>
                    Settings
                </a>
                <a *ngIf="isSeller()" (click)="setActiveSection('seller')" [class.active]="activeSection === 'seller'"
                    class="nav-item">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                        <path d="M3 3H7L10 16H18L21 8H7" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                            stroke-linejoin="round" />
                        <circle cx="10" cy="20" r="1" fill="currentColor" />
                        <circle cx="18" cy="20" r="1" fill="currentColor" />
                    </svg>
                    Seller Profile
                </a>
                <a (click)="logout()" class="nav-item">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                        <path
                            d="M9 21H5C4.46957 21 3.96086 20.7893 3.58579 20.4142C3.21071 20.0391 3 19.5304 3 19V5C3 4.46957 3.21071 3.96086 3.58579 3.58579C3.96086 3.21071 4.46957 3 5 3H9"
                            stroke="currentColor" stroke-width="2" />
                        <path d="M16 17L21 12L16 7" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                        <path d="M21 12H9" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                    </svg>
                    Logout
                </a>
            </nav>

            <!-- Decorative Image -->
            <div class="random-image-container">
                <img src="https://i.pinimg.com/736x/d1/d0/84/d1d084b862d95e03101d0bf3bddc51be.jpg" alt="Decorative"
                    class="random-image" />
            </div>
        </aside>

        <!-- Main Dashboard Content -->
        <div class="dashboard">
            <!-- Dashboard Overview -->
            <div *ngIf="activeSection === 'overview'">
                <!-- Account Stats -->
                <div class="stats-section">
                    <div class="stat-card">
                        <div class="stat-value">{{ getActiveOrdersCount() }}</div>
                        <div class="stat-label">Active Orders</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">{{ orders.length }}</div>
                        <div class="stat-label">Total Orders</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">{{ addresses.length }}</div>
                        <div class="stat-label">Saved Addresses</div>
                    </div>
                </div>



                <!-- Recent Orders Preview -->
                <section class="recent-orders" *ngIf="orders.length > 0">
                    <div class="section-header">
                        <h2>Recent Orders</h2>
                        <button (click)="setActiveSection('orders')" class="view-all-btn">View All</button>
                    </div>
                    <div class="orders-list">
                        <div *ngFor="let order of orders.slice(0, 3)" class="order-item">
                            <div class="order-info">
                                <h3>Order #{{ order.order_id }}</h3>
                                <div class="order-status" [ngClass]="getOrderStatusClass(order.status)">
                                    {{ order.status }}
                                </div>
                            </div>
                            <div class="order-date">{{ formatDate(order.created_at) }}</div>
                            <div class="order-details">
                                <span class="order-total">KSh {{ order.total_amount.toLocaleString() }}</span>
                            </div>
                            <button (click)="viewOrderDetails(order.order_id)" class="view-details">View
                                Details</button>
                        </div>
                    </div>
                </section>

                <!-- No Orders Message -->
                <section class="recent-orders" *ngIf="orders.length === 0">
                    <h2>Recent Orders</h2>
                    <div class="empty-state">
                        <svg width="64" height="64" viewBox="0 0 24 24" fill="none">
                            <path
                                d="M9 5H7C5.89543 5 5 5.89543 5 7V19C5 20.1046 5.89543 21 7 21H17C18.1046 21 19 20.1046 19 19V7C19 5.89543 18.1046 5 17 5H15"
                                stroke="currentColor" stroke-width="2" />
                        </svg>
                        <p>You haven't placed any orders yet.</p>
                        <button routerLink="/shop" class="shop-btn">Start Shopping</button>
                    </div>
                </section>
            </div>

            <!-- Orders Section -->
            <div *ngIf="activeSection === 'orders'" class="section-content">
                <h2 class="section-title">My Orders</h2>

                <div *ngIf="orders.length > 0" class="orders-list">
                    <div *ngFor="let order of orders" class="order-card" [class.expanded]="order.isExpanded">
                        <div class="order-header">
                            <div>
                                <h3>Order #{{ order.order_id }}</h3>
                                <p class="order-date">{{ formatDate(order.created_at) }}</p>
                            </div>
                            <div class="order-status-badge" [ngClass]="getOrderStatusClass(order.status)">
                                {{ order.status }}
                            </div>
                        </div>

                        <div class="order-summary">
                            <div class="order-total-amount">
                                <span class="label">Total Amount:</span>
                                <span class="amount">KSh {{ order.total_amount.toLocaleString() }}</span>
                            </div>
                        </div>

                        <!-- Expanded Order Details -->
                        <div *ngIf="order.isExpanded" class="order-details-expanded">
                            <!-- Customer Information -->
                            <div class="details-section">
                                <h4>Customer Information</h4>
                                <div class="info-grid">
                                    <div class="info-item">
                                        <span class="label">Name:</span>
                                        <span class="value">{{ order.name || 'Not provided' }}</span>
                                    </div>
                                    <div class="info-item">
                                        <span class="label">Email:</span>
                                        <span class="value">{{ order.email || 'Not provided' }}</span>
                                    </div>
                                    <div class="info-item">
                                        <span class="label">Phone:</span>
                                        <span class="value">{{ order.phone || 'Not provided' }}</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Order Items -->
                            <div class="details-section" *ngIf="order.order_items && order.order_items.length > 0">
                                <h4>Order Items ({{ order.order_items.length }})</h4>
                                <div class="order-items-list">
                                    <div *ngFor="let item of order.order_items" class="order-item-detail">
                                        <div class="item-info">
                                            <h5>{{ item.product_title }}</h5>
                                            <p class="item-description" *ngIf="item.product_description">
                                                {{ item.product_description }}
                                            </p>
                                            <div class="item-meta">
                                                <span>Quantity: {{ item.quantity }}</span>
                                                <span>Unit Price: KSh {{ item.unit_price.toLocaleString() }}</span>
                                                <span *ngIf="item.discount > 0">Discount: KSh {{
                                                    item.discount.toLocaleString() }}</span>
                                            </div>
                                        </div>
                                        <div class="item-total">
                                            KSh {{ getOrderItemTotal(item).toLocaleString() }}
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Order Summary -->
                            <div class="details-section">
                                <h4>Order Summary</h4>
                                <div class="summary-grid">
                                    <div class="summary-item">
                                        <span class="label">Subtotal:</span>
                                        <span class="value">KSh {{ getOrderSubtotal(order).toLocaleString() }}</span>
                                    </div>
                                    <div class="summary-item" *ngIf="getOrderDiscountTotal(order) > 0">
                                        <span class="label">Total Discount:</span>
                                        <span class="value">-KSh {{ getOrderDiscountTotal(order).toLocaleString()
                                            }}</span>
                                    </div>
                                    <div class="summary-item">
                                        <span class="label">Shipping:</span>
                                        <span class="value">KSh {{ (order.total_amount - getOrderSubtotal(order) +
                                            getOrderDiscountTotal(order)).toLocaleString() }}</span>
                                    </div>
                                    <div class="summary-item total">
                                        <span class="label">Total Amount:</span>
                                        <span class="value">KSh {{ order.total_amount.toLocaleString() }}</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Order Notes -->
                            <div class="details-section" *ngIf="order.notes">
                                <h4>Order Notes</h4>
                                <p class="order-notes">{{ order.notes }}</p>
                            </div>
                        </div>

                        <div class="order-footer">
                            <button (click)="viewOrderDetails(order.order_id)" class="view-details-btn">
                                {{ order.isExpanded ? 'Hide Details' : 'View Details' }}
                            </button>
                        </div>
                    </div>
                </div>

                <div *ngIf="orders.length === 0" class="empty-state">
                    <svg width="80" height="80" viewBox="0 0 24 24" fill="none">
                        <path
                            d="M9 5H7C5.89543 5 5 5.89543 5 7V19C5 20.1046 5.89543 21 7 21H17C18.1046 21 19 20.1046 19 19V7C19 5.89543 18.1046 5 17 5H15"
                            stroke="currentColor" stroke-width="2" />
                    </svg>
                    <h3>No orders yet</h3>
                    <p>Start shopping to place your first order!</p>
                    <button routerLink="/shop" class="shop-btn">Browse Products</button>
                </div>
            </div>

            <!-- Addresses Section -->
            <div *ngIf="activeSection === 'addresses'" class="section-content">
                <div class="section-header">
                    <h2 class="section-title">Saved Addresses</h2>
                    <button (click)="toggleAddAddressForm()" class="add-address-btn">
                        <svg *ngIf="!showAddAddressForm" width="16" height="16" viewBox="0 0 24 24" fill="none" style="margin-right: 0.5rem;">
                            <path d="M12 5V19M5 12H19" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        {{ showAddAddressForm ? 'Cancel' : 'Add New Address' }}
                    </button>
                </div>

                <!-- Success/Error Messages -->
                <div *ngIf="addressSuccess" class="alert alert-success">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" style="margin-right: 0.5rem;">
                        <path d="M20 6L9 17L4 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    {{ addressSuccess }}
                </div>

                <div *ngIf="addressError" class="alert alert-error">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" style="margin-right: 0.5rem;">
                        <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
                        <path d="M12 8V12M12 16H12.01" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                    {{ addressError }}
                </div>

                <!-- Add New Address Form -->
                <div *ngIf="showAddAddressForm" class="address-card add-address-card" style="animation: slideDown 0.3s ease;">
                    <div class="add-address-header">
                        <h3>‚ú® Add New Address</h3>
                        <p class="add-address-subtitle">Fill in your delivery information</p>
                    </div>
                    
                    <form class="address-edit-form" (ngSubmit)="addNewAddress()">
                        <div class="form-group">
                            <label>Full Name *</label>
                            <input type="text" [(ngModel)]="newAddress.full_name" name="fullName" class="form-input"
                                placeholder="Your full name" required />
                        </div>
                        
                        <div class="form-group">
                            <label>Phone Number *</label>
                            <input type="tel" [(ngModel)]="newAddress.phone" name="phone" class="form-input"
                                placeholder="+254712345678" required />
                            <small class="form-hint">Format: +254XXXXXXXXX</small>
                        </div>
                        
                        <div class="form-group">
                            <label>Street Address *</label>
                            <input type="text" [(ngModel)]="newAddress.street" name="street" class="form-input"
                                placeholder="e.g., Kenyatta Avenue" required />
                        </div>
                        
                        <div class="form-group">
                            <label>Building/Apartment (Optional)</label>
                            <input type="text" [(ngModel)]="newAddress.building" name="building" class="form-input"
                                placeholder="Apartment number, suite, unit, etc." />
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label>City *</label>
                                <input type="text" [(ngModel)]="newAddress.city" name="city" class="form-input"
                                    placeholder="Nairobi" required />
                            </div>
                            <div class="form-group">
                                <label>County *</label>
                                <input type="text" [(ngModel)]="newAddress.county" name="county" class="form-input"
                                    placeholder="Nairobi County" required />
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label>State (Optional)</label>
                                <input type="text" [(ngModel)]="newAddress.state" name="state" class="form-input"
                                    placeholder="State/Region" />
                            </div>
                            <div class="form-group">
                                <label>Postal Code *</label>
                                <input type="text" [(ngModel)]="newAddress.postal_code" name="postalCode"
                                    class="form-input" placeholder="00100" required />
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>Country</label>
                            <input type="text" [(ngModel)]="newAddress.country" name="country" class="form-input"
                                value="Kenya" readonly />
                        </div>
                        
                        <div class="form-actions">
                            <button type="submit" class="add-btn" [disabled]="isAddingAddress">
                                <svg *ngIf="!isAddingAddress" width="16" height="16" viewBox="0 0 24 24" fill="none" style="margin-right: 0.5rem;">
                                    <path d="M20 6L9 17L4 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                                <span *ngIf="isAddingAddress" class="spinner-small"></span>
                                {{ isAddingAddress ? 'Adding...' : 'Add Address' }}
                            </button>
                            <button type="button" (click)="toggleAddAddressForm()" class="cancel-btn">
                                Cancel
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Existing Addresses Grid -->
                <div *ngIf="addresses.length > 0" class="addresses-grid">
                    <div *ngFor="let address of addresses" class="address-card">
                        <div class="address-header">
                            <h3>
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" style="margin-right: 0.5rem; vertical-align: text-bottom;">
                                    <path d="M21 10C21 17 12 23 12 23C12 23 3 17 3 10C3 7.61305 3.94821 5.32387 5.63604 3.63604C7.32387 1.94821 9.61305 1 12 1C14.3869 1 16.6761 1.94821 18.364 3.63604C20.0518 5.32387 21 7.61305 21 10Z"
                                        stroke="currentColor" stroke-width="2" />
                                    <circle cx="12" cy="10" r="3" stroke="currentColor" stroke-width="2" />
                                </svg>
                                {{ user.name }}'s Address
                            </h3>
                            <span *ngIf="address.is_default" class="default-badge">‚úì Default</span>
                        </div>

                        <!-- View Mode -->
                        <div *ngIf="editingAddressId !== address.address_id" class="address-content">
                            <div class="address-info-item">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                                    <path d="M16 7C16 9.20914 14.2091 11 12 11C9.79086 11 8 9.20914 8 7C8 4.79086 9.79086 3 12 3C14.2091 3 16 4.79086 16 7Z" stroke="currentColor" stroke-width="2"/>
                                    <path d="M12 14C8.13401 14 5 17.134 5 21H19C19 17.134 15.866 14 12 14Z" stroke="currentColor" stroke-width="2"/>
                                </svg>
                                <strong>{{ user.email }}</strong>
                            </div>
                            
                            <div class="address-info-item">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                                    <path d="M3 5C3 3.89543 3.89543 3 5 3H8.27924C8.70967 3 9.09181 3.27543 9.22792 3.68377L10.7257 8.17721C10.8831 8.64932 10.6694 9.16531 10.2243 9.38787L7.96701 10.5165C9.06925 12.9612 11.0388 14.9308 13.4835 16.033L14.6121 13.7757C14.8347 13.3306 15.3507 13.1169 15.8228 13.2743L20.3162 14.7721C20.7246 14.9082 21 15.2903 21 15.7208V19C21 20.1046 20.1046 21 19 21H18C9.71573 21 3 14.2843 3 6V5Z" stroke="currentColor" stroke-width="2"/>
                                </svg>
                                {{ user.phone }}
                            </div>
                            
                            <div class="address-info-item">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                                    <path d="M21 10C21 17 12 23 12 23C12 23 3 17 3 10C3 7.61305 3.94821 5.32387 5.63604 3.63604C7.32387 1.94821 9.61305 1 12 1C14.3869 1 16.6761 1.94821 18.364 3.63604C20.0518 5.32387 21 7.61305 21 10Z"
                                        stroke="currentColor" stroke-width="2" />
                                    <circle cx="12" cy="10" r="3" stroke="currentColor" stroke-width="2" />
                                </svg>
                                <div>
                                    {{ address.street }}
                                    <span *ngIf="address.building">, {{ address.building }}</span><br>
                                    {{ address.city }}, {{ address.county }} {{ address.postal_code }}<br>
                                    {{ address.country }}
                                </div>
                            </div>

                            <div class="address-actions">
                                <button (click)="startEditAddress(address)" class="edit-btn">
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" style="margin-right: 0.25rem;">
                                        <path d="M11 4H4C3.46957 4 2.96086 4.21071 2.58579 4.58579C2.21071 4.96086 2 5.46957 2 6V20C2 20.5304 2.21071 21.0391 2.58579 21.4142C2.96086 21.7893 3.46957 22 4 22H18C18.5304 22 19.0391 21.7893 19.4142 21.4142C19.7893 21.0391 20 20.5304 20 20V13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                        <path d="M18.5 2.5C18.8978 2.1021 19.4374 1.8787 20 1.8787C20.5626 1.8787 21.1022 2.1021 21.5 2.5C21.8978 2.89789 22.1213 3.43739 22.1213 4C22.1213 4.56261 21.8978 5.10211 21.5 5.5L12 15L8 16L9 12L18.5 2.5Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                    Edit
                                </button>
                                <button *ngIf="!address.is_default" (click)="setDefaultAddress(address.address_id)"
                                    class="default-btn">
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" style="margin-right: 0.25rem;">
                                        <path d="M20 6L9 17L4 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                    Set Default
                                </button>
                                <button (click)="deleteAddress(address.address_id)" class="delete-btn">
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" style="margin-right: 0.25rem;">
                                        <path d="M3 6H5H21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                        <path d="M8 6V4C8 3.46957 8.21071 2.96086 8.58579 2.58579C8.96086 2.21071 9.46957 2 10 2H14C14.5304 2 15.0391 2.21071 15.4142 2.58579C15.7893 2.96086 16 3.46957 16 4V6M19 6V20C19 20.5304 18.7893 21.0391 18.4142 21.4142C18.0391 21.7893 17.5304 22 17 22H7C6.46957 22 5.96086 21.7893 5.58579 21.4142C5.21071 21.0391 5 20.5304 5 20V6H19Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                    Delete
                                </button>
                            </div>
                        </div>

                        <!-- Edit Mode -->
                        <div *ngIf="editingAddressId === address.address_id" class="address-edit-form">
                            <div class="form-group">
                                <label>Full Name *</label>
                                <input type="text" [(ngModel)]="editAddressData.full_name" class="form-input"
                                    placeholder="Your full name" required />
                            </div>
                            <div class="form-group">
                                <label>Phone Number *</label>
                                <input type="tel" [(ngModel)]="editAddressData.phone" class="form-input"
                                    placeholder="+254..." required />
                            </div>
                            <div class="form-group">
                                <label>Street Address *</label>
                                <input type="text" [(ngModel)]="editAddressData.street" class="form-input"
                                    placeholder="Street address" required />
                            </div>
                            <div class="form-group">
                                <label>Building/Apartment (Optional)</label>
                                <input type="text" [(ngModel)]="editAddressData.building" class="form-input"
                                    placeholder="Apartment, suite, etc." />
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>City *</label>
                                    <input type="text" [(ngModel)]="editAddressData.city" class="form-input"
                                        placeholder="Nairobi" required />
                                </div>
                                <div class="form-group">
                                    <label>County *</label>
                                    <input type="text" [(ngModel)]="editAddressData.county" class="form-input"
                                        placeholder="Nairobi County" required />
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>State</label>
                                    <input type="text" [(ngModel)]="editAddressData.state" class="form-input"
                                        placeholder="State" />
                                </div>
                                <div class="form-group">
                                    <label>Postal Code *</label>
                                    <input type="text" [(ngModel)]="editAddressData.postal_code" class="form-input"
                                        placeholder="00100" required />
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Country</label>
                                <input type="text" [(ngModel)]="editAddressData.country" class="form-input"
                                    value="Kenya" readonly />
                            </div>

                            <div class="form-actions">
                                <button (click)="saveAddress(address.address_id)" class="save-btn">Save Changes</button>
                                <button (click)="cancelEditAddress()" class="cancel-btn">Cancel</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Empty State -->
                <div *ngIf="addresses.length === 0 && !showAddAddressForm" class="empty-state">
                    <svg width="80" height="80" viewBox="0 0 24 24" fill="none">
                        <path
                            d="M21 10C21 17 12 23 12 23C12 23 3 17 3 10C3 7.61305 3.94821 5.32387 5.63604 3.63604C7.32387 1.94821 9.61305 1 12 1C14.3869 1 16.6761 1.94821 18.364 3.63604C20.0518 5.32387 21 7.61305 21 10Z"
                            stroke="currentColor" stroke-width="2" />
                        <circle cx="12" cy="10" r="3" stroke="currentColor" stroke-width="2" />
                    </svg>
                    <h3>No saved addresses</h3>
                    <p>Add your first delivery address to get started!</p>
                    <button (click)="toggleAddAddressForm()" class="shop-btn">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" style="margin-right: 0.5rem;">
                            <path d="M12 5V19M5 12H19" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        Add Address
                    </button>
                </div>
            </div>

            <div *ngIf="addresses.length === 0" class="empty-state">
                <svg width="80" height="80" viewBox="0 0 24 24" fill="none">
                    <path
                        d="M21 10C21 17 12 23 12 23C12 23 3 17 3 10C3 7.61305 3.94821 5.32387 5.63604 3.63604C7.32387 1.94821 9.61305 1 12 1C14.3869 1 16.6761 1.94821 18.364 3.63604C20.0518 5.32387 21 7.61305 21 10Z"
                        stroke="currentColor" stroke-width="2" />
                    <circle cx="12" cy="10" r="3" stroke="currentColor" stroke-width="2" />
                </svg>
                <h3>No saved addresses</h3>
                <p>Add your first delivery address!</p>
            </div>
        </div>

        <!-- Payments Section -->
        <div *ngIf="activeSection === 'payments'" class="section-content">
            <h2 class="section-title">Payment History</h2>

            <div *ngIf="payments.length > 0" class="payments-grid">
                <div *ngFor="let payment of payments" class="payment-card">
                    <div class="payment-header">
                        <div>
                            <h3>Payment #{{ payment.payment_id }}</h3>
                            <p class="payment-date">{{ formatDate(payment.created_at) }}</p>
                        </div>
                        <div class="payment-status-badge" [ngClass]="getPaymentStatusClass(payment)">
                            {{ payment.status }}
                        </div>
                    </div>
                    <div class="payment-body">
                        <div class="payment-info">
                            <span class="label">Order ID:</span>
                            <span class="value">#{{ payment.order_id }}</span>
                        </div>
                        <div class="payment-info">
                            <span class="label">Payment Method:</span>
                            <span class="value">{{ payment.method }}</span>
                        </div>
                        <div class="payment-info">
                            <span class="label">Amount:</span>
                            <span class="value amount">KSh {{ payment.amount.toLocaleString() }}</span>
                        </div>
                        <div class="payment-info" *ngIf="payment.transaction_reference">
                            <span class="label">Transaction ID:</span>
                            <span class="value">{{ payment.transaction_reference }}</span>
                        </div>
                    </div>
                </div>
            </div>

            <div *ngIf="payments.length === 0" class="empty-state">
                <svg width="80" height="80" viewBox="0 0 24 24" fill="none">
                    <rect x="2" y="5" width="20" height="14" rx="2" stroke="currentColor" stroke-width="2" />
                    <path d="M2 10H22" stroke="currentColor" stroke-width="2" />
                </svg>
                <h3>No payment history</h3>
                <p>Your payment transactions will appear here.</p>
            </div>
        </div>

        <!-- Settings Section -->
        <div *ngIf="activeSection === 'settings'" class="section-content">
            <h2 class="section-title">Account Settings</h2>

            <div class="settings-card">
                <h3>Personal Information</h3>

                <!-- View Mode -->
                <div *ngIf="!isEditingProfile" class="profile-info">
                    <div class="info-row">
                        <span class="label">Name:</span>
                        <span class="value">{{ user.name }}</span>
                    </div>
                    <div class="info-row">
                        <span class="label">Email:</span>
                        <span class="value">{{ user.email }}</span>
                    </div>
                    <div class="info-row">
                        <span class="label">Role:</span>
                        <span class="value">{{ user.role }}</span>
                    </div>
                    <div class="info-row">
                        <span class="label">Phone:</span>
                        <span class="value">{{ user.phone || 'Not provided' }}</span>
                    </div>
                    <button (click)="toggleEditProfile()" class="edit-profile-btn">Edit Profile</button>
                </div>

                <!-- Edit Mode -->
                <div *ngIf="isEditingProfile" class="profile-edit-form">
                    <div class="form-group">
                        <label>Name</label>
                        <input type="text" [(ngModel)]="editUserData.name" class="form-input" />
                    </div>
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" [(ngModel)]="editUserData.email" class="form-input" />
                    </div>
                    <div class="form-group">
                        <label>Phone</label>
                        <input type="tel" [(ngModel)]="editUserData.phone" class="form-input" placeholder="+254..." />
                    </div>

                    <div class="form-actions">
                        <button (click)="saveProfile()" class="save-btn">Save Changes</button>
                        <button (click)="cancelEditProfile()" class="cancel-btn">Cancel</button>
                    </div>
                </div>
            </div>

            <div class="settings-card">
                <h3>Security</h3>
                <p>Change your password or update security settings</p>
                <button class="secondary-btn" disabled>Change Password (Coming Soon)</button>
            </div>

            <div class="settings-card danger-zone">
                <h3>Danger Zone</h3>
                <p>Permanently delete your account and all associated data</p>
                <button class="danger-btn" disabled>Delete Account (Coming Soon)</button>
            </div>
        </div>
        <!-- Seller Profile Section -->
        <!-- Seller Profile Section -->
        <div *ngIf="activeSection === 'seller'" class="section-content">
            <h2 class="section-title">Seller Profile</h2>

            <!-- Loading State -->
            <div *ngIf="isLoadingSeller" class="loading-container" style="min-height: 200px;">
                <div class="spinner"></div>
                <p>Loading seller profile...</p>
            </div>

            <!-- Success Message -->
            <div *ngIf="sellerSuccess && !isLoadingSeller" class="alert alert-success"
                style="background: #d1fae5; border: 1px solid #10b981; color: #065f46; padding: 1rem; border-radius: 8px; margin-bottom: 1.5rem;">
                ‚úì {{ sellerSuccess }}
            </div>

            <!-- Error Message -->
            <div *ngIf="sellerError && !isLoadingSeller" class="alert alert-error"
                style="background: #fee2e2; border: 1px solid #ef4444; color: #991b1b; padding: 1rem; border-radius: 8px; margin-bottom: 1.5rem;">
                ‚úó {{ sellerError }}
            </div>

            <!-- No Seller Profile Yet -->
            <div *ngIf="!isLoadingSeller && !sellerProfile && !isEditingSeller" class="settings-card">
                <div style="text-align: center; padding: 2rem 0; color: #6b7280;">
                    <div style="font-size: 3rem; margin-bottom: 1rem;">üè™</div>
                    <h3 style="margin-bottom: 1rem; font-size: 1.5rem; color: #1e293b;">No Seller Profile</h3>
                    <p style="margin-bottom: 2rem; color: #64748b;">You haven't set up your seller profile yet. Create
                        one to start selling on TechWave.</p>
                    <button (click)="toggleEditSeller()" class="edit-profile-btn">
                        Create Seller Profile
                    </button>
                </div>
            </div>

            <!-- View Seller Profile -->
            <div *ngIf="!isLoadingSeller && sellerProfile && !isEditingSeller">
                <div class="settings-card">
                    <h3>Business Information</h3>

                    <div class="profile-info">
                        <div class="info-row">
                            <span class="label">Business Name:</span>
                            <span class="value">{{ sellerProfile.business_name }}</span>
                        </div>
                        <div class="info-row">
                            <span class="label">Business License:</span>
                            <span class="value">{{ sellerProfile.business_license }}</span>
                        </div>
                        <div class="info-row">
                            <span class="label">Tax ID / KRA PIN:</span>
                            <span class="value">{{ sellerProfile.tax_id }}</span>
                        </div>
                        <div class="info-row" *ngIf="sellerProfile.total_sales !== undefined">
                            <span class="label">Total Sales:</span>
                            <span class="value" style="color: #10b981; font-weight: 600;">{{
                                formatCurrency(sellerProfile.total_sales || 0) }}</span>
                        </div>
                        <div class="info-row" *ngIf="sellerProfile.created_at">
                            <span class="label">Member Since:</span>
                            <span class="value">{{ formatDate(sellerProfile.created_at) }}</span>
                        </div>
                    </div>

                    <button (click)="toggleEditSeller()" class="edit-profile-btn">Edit Seller Profile</button>
                </div>

                <!-- Seller Stats -->
                <div
                    style="margin-top: 2rem; display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem;">
                    <div class="stat-card">
                        <div class="stat-header">
                            <div>
                                <div class="stat-title">Profile Status</div>
                                <div class="stat-value" style="font-size: 1.5rem;">
                                    <span class="status-badge status-delivered">‚úì Active</span>
                                </div>
                            </div>
                            <div class="stat-icon"
                                style="background: linear-gradient(135deg, #10b981, #059669); color: white; width: 60px; height: 60px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 1.5rem;">
                                ‚úì
                            </div>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-header">
                            <div>
                                <div class="stat-title">Business Verified</div>
                                <div class="stat-value" style="font-size: 1.5rem;">
                                    <span class="status-badge status-processing">‚è≥ Pending</span>
                                </div>
                            </div>
                            <div class="stat-icon"
                                style="background: linear-gradient(135deg, #3b82f6, #1d4ed8); color: white; width: 60px; height: 60px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 1.5rem;">
                                üîç
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions for Sellers -->
                <div class="settings-card" style="margin-top: 2rem;">
                    <h3>Seller Actions</h3>
                    <p style="color: #64748b; margin-bottom: 1rem;">Manage your seller account and products</p>
                    <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                        <button routerLink="/seller-dashboard" class="edit-profile-btn"
                            style="flex: 1; min-width: 200px;">
                            üìä Go to Seller Dashboard
                        </button>
                        <button routerLink="/seller-dashboard" class="secondary-btn" style="flex: 1; min-width: 200px;">
                            üì¶ Manage Products
                        </button>
                    </div>
                </div>
            </div>

            <!-- Edit Seller Profile Form -->
            <div *ngIf="!isLoadingSeller && isEditingSeller">
                <div class="settings-card">
                    <h3>{{ sellerProfile ? 'Edit' : 'Create' }} Seller Profile</h3>

                    <form class="profile-edit-form">
                        <div class="form-group">
                            <label>Business Name *</label>
                            <input type="text" [(ngModel)]="editSellerData.business_name" name="businessName"
                                class="form-input" placeholder="Enter your business name" required />
                            <small style="color: #6b7280; font-size: 0.85rem; margin-top: 0.25rem; display: block;">
                                This is the name that will appear on your products and store page.
                            </small>
                        </div>

                        <div class="form-group">
                            <label>Business License *</label>
                            <input type="text" [(ngModel)]="editSellerData.business_license" name="businessLicense"
                                class="form-input" placeholder="Enter your business license number" required />
                            <small style="color: #6b7280; font-size: 0.85rem; margin-top: 0.25rem; display: block;">
                                Your official business registration or license number.
                            </small>
                        </div>

                        <div class="form-group">
                            <label>Tax ID / KRA PIN *</label>
                            <input type="text" [(ngModel)]="editSellerData.tax_id" name="taxId" class="form-input"
                                placeholder="Enter your Tax ID or KRA PIN" required />
                            <small style="color: #6b7280; font-size: 0.85rem; margin-top: 0.25rem; display: block;">
                                Your tax identification number for compliance purposes.
                            </small>
                        </div>

                        <div class="form-actions">
                            <button type="button" (click)="saveSeller()" class="save-btn" [disabled]="isLoadingSeller">
                                {{ isLoadingSeller ? 'Saving...' : (sellerProfile ? 'Update Profile' : 'Create Profile')
                                }}
                            </button>
                            <button type="button" (click)="cancelEditSeller()" class="cancel-btn"
                                [disabled]="isLoadingSeller">
                                Cancel
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Information Card -->
                <div class="settings-card" style="margin-top: 2rem; background: #f8fafc; border: 2px dashed #cbd5e1;">
                    <div style="display: flex; gap: 1rem; align-items: start;">
                        <div style="font-size: 2rem;">‚ÑπÔ∏è</div>
                        <div>
                            <h3 style="font-size: 1.1rem; font-weight: 600; margin-bottom: 0.5rem; color: #1f2937;">
                                Important Information</h3>
                            <ul style="color: #6b7280; font-size: 0.9rem; padding-left: 1.5rem; line-height: 1.8;">
                                <li>All fields marked with * are required to complete your seller profile.</li>
                                <li>Your business information will be verified by our team.</li>
                                <li>Accurate information helps build trust with customers.</li>
                                <li>You can update your seller profile information at any time.</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

</main>

<!-- Footer -->
<app-footer></app-footer>