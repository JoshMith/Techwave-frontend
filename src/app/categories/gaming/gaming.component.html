<!-- Header Navigation -->
<app-header></app-header>
<main class="main-content">
  <div class="container">

    <h1>Gaming ({{ filteredProducts.length }} products)</h1>

    <div class="content-grid">
      <aside class="filters-sidebar">
        <div class="filters-container">
          <h2 class="filters-title">Filters</h2>

          <div class="filter-section">
            <h3 class="filter-heading">Price Range (KSh)</h3>
            <div class="price-range">
              <div class="price-inputs">
                <input type="number" [(ngModel)]="priceRange.min" (change)="applyFilters()" aria-label="Minimum price">
                <span>-</span>
                <input type="number" [(ngModel)]="priceRange.max" (change)="applyFilters()" aria-label="Maximum price">
              </div>
              <button class="apply-btn" (click)="applyFilters()">Apply</button>
            </div>
          </div>

          <div class="filter-section">
            <h3 class="filter-heading">Brand</h3>
            <div class="checkbox-group">
              <label class="checkbox-item" *ngFor="let brand of brands">
                <input type="checkbox" [checked]="selectedBrands.includes(brand)" (change)="toggleBrand(brand)">
                <span class="checkmark"></span>
                {{ brand }}
              </label>
            </div>
          </div>

          <div class="filter-section">
            <h3 class="filter-heading">Features</h3>
            <div class="checkbox-group">
              <label class="checkbox-item" *ngFor="let feature of features">
                <input type="checkbox" [checked]="selectedFeatures.includes(feature)" (change)="toggleFeature(feature)">
                <span class="checkmark"></span>
                {{ feature }}
              </label>
            </div>
          </div>

          <button class="reset-filters-btn" (click)="resetFilters()">Reset Filters</button>
        </div>
      </aside>

      <section class="products-section">
        <div class="sort-controls">
          <div class="sort-dropdown">
            <label for="sort-select" class="visually-hidden">Sort products</label>
            <select id="sort-select" [(ngModel)]="selectedSort" (change)="applyFilters()" class="sort-select">
              <option *ngFor="let option of sortOptions" [value]="option.value">
                {{ option.label }}
              </option>
            </select>
            <svg class="sort-arrow" width="16" height="16" viewBox="0 0 24 24" fill="none"
              xmlns="http://www.w3.org/2000/svg">
              <path d="M6 9L12 15L18 9" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                stroke-linejoin="round" />
            </svg>
          </div>
        </div>

        <div class="products-grid" *ngIf="!loading; else loadingTemplate">
          <div class="product-card" *ngFor="let product of filteredProducts">
            <div class="product-badges" *ngIf="product.sale_price">
              <div class="discount-badge">
                {{ ((product.price - product.sale_price) / product.price * 100).toFixed(0) }}% OFF
              </div>
            </div>
            <div class="product-image">
              <img [src]="getProductImage(product)" [alt]="product.title" (error)="onImageError($event)" loading="lazy"
                *ngIf="product.images; else imageLoading">
              <ng-template #imageLoading>
                <div class="image-placeholder">Gaming Product</div>
              </ng-template>
            </div>
            <div class="product-info">
              <h3 class="product-name">{{ product.title }}</h3>
              <p class="product-specs">{{ formatSpecs(product.specs) }}</p>
              <div class="product-rating">
                <div class="stars">
                  <span *ngFor="let star of [1,2,3,4,5]" class="star" [class.filled]="star <= product.rating">
                    â˜…
                  </span>
                </div>
                <span class="rating-count">({{ product.review_count }})</span>
              </div>
              <div class="price-container">
                <span *ngIf="product.sale_price" class="original-price">KSh {{ product.price | number }}</span>
                <span class="product-price">KSh {{ (product.sale_price || product.price) | number }}</span>
              </div>
              <div class="product-footer">
                <button class="add-to-cart" (click)="addToCart(product)">Add to Cart</button>
                <button class="view-details" (click)="viewProductDetails(product)">View Details</button>
              </div>
            </div>
          </div>
        </div>

        <ng-template #loadingTemplate>
          <div class="loading-container">
            <div class="loading-spinner"></div>
            <p>Loading products...</p>
          </div>
        </ng-template>

        <div class="empty-state" *ngIf="!loading && filteredProducts.length === 0">
          <svg width="64" height="64" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <circle cx="12" cy="12" r="10" stroke="#9ca3af" stroke-width="2" />
            <path d="M8 12L12 16L16 12" stroke="#9ca3af" stroke-width="2" stroke-linecap="round"
              stroke-linejoin="round" />
          </svg>
          <h3>No products found</h3>
          <p>Try adjusting your filters or search criteria</p>
        </div>
      </section>
    </div>
  </div>
</main>

<app-footer></app-footer>