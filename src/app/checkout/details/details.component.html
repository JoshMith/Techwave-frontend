<!-- details.component.html -->
<div class="details-container">
  <div class="details-header">
    <button class="back-btn" (click)="goBack()">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M19 12H5M5 12L12 19M5 12L12 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
      Back to Cart
    </button>
    <h1>Checkout Details</h1>
  </div>

  <div class="details-content" *ngIf="orderData">
    <!-- Error message -->
    <div class="error-message" *ngIf="error">
      {{ error }}
    </div>

    <div class="details-layout">
      <!-- Left Column - Forms -->
      <div class="details-forms">
        <!-- Contact Information -->
        <div class="form-section">
          <h2>Contact Information</h2>
          <div class="form-group">
            <label for="email">Email *</label>
            <input 
              type="email" 
              id="email" 
              [(ngModel)]="contactInfo.email" 
              placeholder="your@email.com"
              required
            />
          </div>
          <div class="form-group">
            <label for="phone">Phone Number *</label>
            <input 
              type="tel" 
              id="phone" 
              [(ngModel)]="contactInfo.phone" 
              placeholder="+254 700 000 000"
              required
            />
          </div>
        </div>

        <!-- Delivery Address -->
        <div class="form-section">
          <div class="section-header">
            <h2>Delivery Address</h2>
            <button class="add-address-btn" (click)="toggleAddressForm()">
              {{ showAddressForm ? 'Cancel' : '+ Add New Address' }}
            </button>
          </div>

          <!-- Loading state -->
          <div *ngIf="isLoadingAddresses" class="loading">
            Loading addresses...
          </div>

          <!-- Existing addresses -->
          <div *ngIf="!isLoadingAddresses && addresses.length > 0" class="addresses-list">
            <div 
              *ngFor="let address of addresses" 
              class="address-card"
              [class.selected]="selectedAddressId === address.id"
              (click)="selectAddress(address.id)"
            >
              <input 
                type="radio" 
                [checked]="selectedAddressId === address.id"
                [id]="'address-' + address.id"
                name="address"
              />
              <div class="address-content">
                <p class="address-line">{{ address.address_line1 }}</p>
                <p class="address-line" *ngIf="address.address_line2">{{ address.address_line2 }}</p>
                <p class="address-line">{{ address.city }}, {{ address.state }} {{ address.postal_code }}</p>
                <p class="address-line">{{ address.country }}</p>
                <span class="default-badge" *ngIf="address.is_default">Default</span>
              </div>
            </div>
          </div>

          <!-- No addresses message -->
          <div *ngIf="!isLoadingAddresses && addresses.length === 0 && !showAddressForm" class="no-addresses">
            <p>No saved addresses. Please add a delivery address.</p>
          </div>

          <!-- New address form -->
          <div *ngIf="showAddressForm" class="new-address-form">
            <div class="form-group">
              <label for="address_line1">Address Line 1 *</label>
              <input 
                type="text" 
                id="address_line1" 
                [(ngModel)]="newAddress.address_line1"
                placeholder="Street address"
                required
              />
            </div>
            <div class="form-group">
              <label for="address_line2">Address Line 2</label>
              <input 
                type="text" 
                id="address_line2" 
                [(ngModel)]="newAddress.address_line2"
                placeholder="Apartment, suite, etc. (optional)"
              />
            </div>
            <div class="form-row">
              <div class="form-group">
                <label for="city">City *</label>
                <input 
                  type="text" 
                  id="city" 
                  [(ngModel)]="newAddress.city"
                  placeholder="City"
                  required
                />
              </div>
              <div class="form-group">
                <label for="state">State/County *</label>
                <input 
                  type="text" 
                  id="state" 
                  [(ngModel)]="newAddress.state"
                  placeholder="State/County"
                  required
                />
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label for="postal_code">Postal Code *</label>
                <input 
                  type="text" 
                  id="postal_code" 
                  [(ngModel)]="newAddress.postal_code"
                  placeholder="Postal Code"
                  required
                />
              </div>
              <div class="form-group">
                <label for="country">Country *</label>
                <input 
                  type="text" 
                  id="country" 
                  [(ngModel)]="newAddress.country"
                  placeholder="Country"
                  required
                />
              </div>
            </div>
            <div class="form-group checkbox-group">
              <input 
                type="checkbox" 
                id="is_default" 
                [(ngModel)]="newAddress.is_default"
              />
              <label for="is_default">Set as default address</label>
            </div>
            <button class="save-address-btn" (click)="saveNewAddress()">
              Save Address
            </button>
          </div>
        </div>

        <!-- Delivery Method -->
        <div class="form-section">
          <h2>Delivery Method</h2>
          <div class="delivery-options">
            <div 
              class="delivery-option"
              [class.selected]="deliveryMethod === 'standard'"
              (click)="deliveryMethod = 'standard'"
            >
              <input 
                type="radio" 
                id="standard" 
                value="standard"
                [(ngModel)]="deliveryMethod"
                name="delivery"
              />
              <div class="delivery-info">
                <h3>Standard Delivery</h3>
                <p>3-5 business days</p>
                <p class="delivery-price">{{ orderData.shipping > 0 ? 'KSh ' + orderData.shipping : 'Free' }}</p>
              </div>
            </div>
            <div 
              class="delivery-option"
              [class.selected]="deliveryMethod === 'express'"
              (click)="deliveryMethod = 'express'"
            >
              <input 
                type="radio" 
                id="express" 
                value="express"
                [(ngModel)]="deliveryMethod"
                name="delivery"
              />
              <div class="delivery-info">
                <h3>Express Delivery</h3>
                <p>1-2 business days</p>
                <p class="delivery-price">KSh 1,500</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Right Column - Order Summary -->
      <div class="order-summary-section">
        <div class="order-summary-sticky">
          <h2>Order Summary</h2>
          
          <!-- Order Items -->
          <div class="summary-items">
            <div *ngFor="let item of orderItems" class="summary-item">
              <div class="item-info">
                <p class="item-name">{{ item.name }}</p>
                <p class="item-qty">Qty: {{ item.quantity }}</p>
              </div>
              <p class="item-price">KSh {{ (item.price * item.quantity) | number }}</p>
            </div>
          </div>

          <!-- Price Breakdown -->
          <div class="price-breakdown">
            <div class="price-row">
              <span>Subtotal</span>
              <span>KSh {{ orderData.subtotal | number }}</span>
            </div>
            <div class="price-row">
              <span>Shipping</span>
              <span>{{ orderData.shipping > 0 ? ('KSh ' + orderData.shipping) : 'Free' }}</span>
            </div>
            <div class="price-row">
              <span>Tax (16% VAT)</span>
              <span>KSh {{ orderData.tax | number }}</span>
            </div>
            <div *ngIf="orderData.couponDiscount > 0" class="price-row discount">
              <span>Discount</span>
              <span>-KSh {{ orderData.couponDiscount | number }}</span>
            </div>
            <div class="price-row total">
              <span>Total</span>
              <span>KSh {{ orderData.total | number }}</span>
            </div>
          </div>

          <!-- Proceed Button -->
          <button 
            class="proceed-btn" 
            (click)="proceedToPayment()"
            [disabled]="isProcessing || !selectedAddressId"
          >
            <span *ngIf="!isProcessing">Proceed to Payment</span>
            <span *ngIf="isProcessing">Processing...</span>
          </button>

          <!-- Security Info -->
          <div class="security-info">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <span>Secure checkout</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- No order data message -->
  <div *ngIf="!orderData" class="no-data">
    <p>No order data available. Please start from the cart.</p>
    <button class="back-btn" (click)="goBack()">Go to Cart</button>
  </div>
</div>