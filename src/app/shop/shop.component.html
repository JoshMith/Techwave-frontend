<!-- Header Navigation -->
<app-header></app-header>
<main class="shop-container">
  <!-- Hero Section -->
  <section class="hero-banner">
    <div class="hero-content">
      <h1>Discover Tech That Inspires</h1>
      <p>Premium electronics at competitive prices with free delivery in Nairobi for orders over KSh 5,000</p>
      <button class="shop-now-btn" (click)="resetFilters()">Shop Now</button>
    </div>
  </section>

  <!-- Featured Categories -->
  <section class="featured-categories">
    <h2>Shop by Category</h2>
    <div class="categories-grid">
      <div *ngFor="let category of featuredCategories" class="category-card"
        [class.active]="selectedCategory === category.name" (click)="onCategoryClick(category.name)">
        <div class="category-icon">{{category.icon}}</div>
        <h3>{{category.name}}</h3>
        <p>{{category.count}} products</p>
      </div>
    </div>
  </section>

  <!-- Special Offers -->
  <section class="special-offers">
    <h2>Special Offers</h2>
    <div class="offers-container">
      <div *ngFor="let offer of specialOffers" class="offer-card">
        <div class="offer-badge" *ngIf="offer.discount">
          {{offer.discount}}% OFF
        </div>
        <h3>{{offer.title}}</h3>
        <p>{{offer.description}}</p>
        <button class="view-offer-btn">View Offer</button>
      </div>
    </div>
  </section>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-container">
    <div class="loading-spinner"></div>
    <p>Loading products...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="errorMessage && !loading" class="error-container">
    <p>{{errorMessage}}</p>
    <button class="retry-btn" (click)="loadProducts()">Retry</button>
  </div>

  <!-- Products Section -->
  <section class="products-section" *ngIf="!loading && !errorMessage">
    <div class="section-header">
      <h2>Browse Products</h2>
      <div class="controls">
        <div class="results-count">
          Showing {{filteredProducts.length}} of {{allProducts.length}} products
        </div>
        <div class="sort-control">
          <label for="sort">Sort by:</label>
          <select id="sort" [(ngModel)]="sortOption" (change)="applyFilters()">
            <option *ngFor="let option of sortOptions" [value]="option.value">
              {{option.label}}
            </option>
          </select>
        </div>
      </div>
    </div>

    <div class="products-layout">
      <!-- Filters Sidebar -->
      <aside class="filters-sidebar">
        <div class="filter-header">
          <h3>Filters</h3>
          <button class="reset-btn" (click)="resetFilters()">Reset All</button>
        </div>

        <!-- Price Range Filter -->
        <div class="filter-group">
          <h4>Price Range</h4>
          <div class="price-range">
            <div class="price-inputs">
              <input type="number" [(ngModel)]="minPrice" (change)="applyFilters()" placeholder="Min">
              <span>-</span>
              <input type="number" [(ngModel)]="maxPrice" (change)="applyFilters()" placeholder="Max">
            </div>
            <button class="apply-btn" (click)="applyFilters()">Apply</button>
          </div>
          <div class="price-values">
            <span>KSh {{minPrice | number}}</span>
            <span>KSh {{maxPrice | number}}</span>
          </div>
        </div>

        <!-- Category Filter -->
        <div class="filter-group">
          <h4>Category</h4>
          <ul class="filter-list">
            <li *ngFor="let cat of categories">
              <label>
                <input type="radio" name="category" [value]="cat" [(ngModel)]="selectedCategory"
                  (change)="applyFilters()">
                {{cat === 'all' ? 'All Categories' : cat}}
              </label>
            </li>
          </ul>
        </div>

        <!-- Brand Filter -->
        <div class="filter-group">
          <h4>Brand</h4>
          <ul class="filter-list">
            <li *ngFor="let brand of brands">
              <label>
                <input type="radio" name="brand" [value]="brand" [(ngModel)]="selectedBrand" (change)="applyFilters()">
                {{brand === 'all' ? 'All Brands' : brand}}
              </label>
            </li>
          </ul>
        </div>
      </aside>

      <!-- Products Grid - Using Correct Product Card Structure -->
      <div class="products-grid" *ngIf="!loading; else loadingTemplate">
        <div class="product-card" *ngFor="let product of filteredProducts">
          <!-- Product Badges -->
          <div class="product-badges" *ngIf="product.sale_price">
            <div class="discount-badge">
              {{getDiscountPercentage(product)}}% OFF
            </div>
          </div>

          <!-- Product Image -->
          <div class="product-image">
            <img [src]="getProductImage(product)" [alt]="product.title" (error)="onImageError($event)" loading="lazy"
              *ngIf="product.images; else imageLoading">
            <ng-template #imageLoading>
              <div class="image-placeholder">Product Image</div>
            </ng-template>
          </div>

          <!-- Product Info -->
          <div class="product-info">
            <h3 class="product-name">{{ product.title }}</h3>
            <p class="product-specs">{{ getProductSpecs(product) }}</p>

            <!-- Product Rating and Price -->
            <div class="product-rating">
              <div class="stars">
                <span *ngFor="let star of [1,2,3,4,5]" class="star" [class.filled]="star <= product.rating"
                  [class.half]="star === Math.ceil(product.rating) && product.rating % 1 !== 0">
                  â˜…
                </span>
              </div>
              <span class="rating-count">({{ product.review_count }})</span>
            </div>

            <!-- Price -->
            <div class="price-container">
              <span class="original-price" *ngIf="product.sale_price">KSh {{ product.price | number:'1.0-0' }}</span>
              <span class="product-price">KSh {{ getDisplayPrice(product) | number:'1.0-0' }}</span>
            </div>

            <!-- Product Footer -->
            <div class="product-footer">
              <button class="add-to-cart" (click)="addToCart(product)" [disabled]="addingToCart || product.stock < 1">
                {{product.stock < 1 ? 'Out of Stock' : 'Add to Cart' }} </button>
                  <button class="view-details" (click)="viewProductDetails(product)">View Details</button>
            </div>
          </div>
        </div>

        <!-- Empty State -->
        <div *ngIf="filteredProducts.length === 0" class="empty-state">
          <svg width="64" height="64" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <circle cx="12" cy="12" r="10" stroke="#9ca3af" stroke-width="2" />
            <path d="M8 12L12 16L16 12" stroke="#9ca3af" stroke-width="2" stroke-linecap="round"
              stroke-linejoin="round" />
          </svg>
          <h3>No products found</h3>
          <p>Try adjusting your filters or search criteria</p>
        </div>
      </div>

      <!-- Loading Template -->
      <ng-template #loadingTemplate>
        <div class="loading-container">
          <div class="loading-spinner"></div>
          <p>Loading products...</p>
        </div>
      </ng-template>
    </div>
  </section>
</main>

<!-- Footer -->
<app-footer></app-footer>