<!-- Header Navigation -->
<header class="header">
  <nav class="nav-container">
    <a routerLink="/" class="logo">
      <img routerLink="/" src="favicon.ico" width="50px" alt="Logo">
    </a>
    <div class="nav-items">

      <a routerLink="/" class="nav-link">Home</a>
      <a routerLink="/shop" class="nav-link">Shop</a>
      <div class="dropdown">
        <a class="nav-link dropdown-trigger">
          Categories
          <svg class="dropdown-arrow" width="16" height="16" viewBox="0 0 24 24" fill="none"
            xmlns="http://www.w3.org/2000/svg">
            <path d="M6 9L12 15L18 9" stroke="currentColor" stroke-width="2" stroke-linecap="round"
              stroke-linejoin="round" />
          </svg>
        </a>
        <div class="dropdown-menu">
          <a routerLink="/categories/Phones" class="dropdown-link">
            <svg class="dropdown-icon" width="20" height="20" viewBox="0 0 24 24" fill="none"
              xmlns="http://www.w3.org/2000/svg">
              <rect x="5" y="2" width="14" height="20" rx="2" ry="2" stroke="currentColor" stroke-width="2" />
              <line x1="12" y1="18" x2="12.01" y2="18" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                stroke-linejoin="round" />
            </svg>
            Phones
          </a>
          <a routerLink="/categories/Laptops" class="dropdown-link">
            <svg class="dropdown-icon" width="20" height="20" viewBox="0 0 24 24" fill="none"
              xmlns="http://www.w3.org/2000/svg">
              <rect x="2" y="4" width="20" height="12" rx="2" ry="2" stroke="currentColor" stroke-width="2" />
              <line x1="2" y1="20" x2="22" y2="20" stroke="currentColor" stroke-width="2" />
            </svg>
            Laptops
          </a>
          <a routerLink="/categories/Accessories" class="dropdown-link">
            <svg class="dropdown-icon" width="20" height="20" viewBox="0 0 24 24" fill="none"
              xmlns="http://www.w3.org/2000/svg">
              <path d="M3 18V15C3 13.3431 4.34315 12 6 12C7.65686 12 9 13.3431 9 15V18" stroke="currentColor"
                stroke-width="2" />
              <path d="M21 18V15C21 13.3431 19.6569 12 18 12C16.3431 12 15 13.3431 15 15V18" stroke="currentColor"
                stroke-width="2" />
              <path
                d="M9 9C9 6.79086 10.7909 5 13 5H11C8.79086 5 7 6.79086 7 9V12H15V9C15 6.79086 16.2091 5 18.5 5H16.5C14.2909 5 12.5 6.79086 12.5 9"
                stroke="currentColor" stroke-width="2" />
            </svg>
            Accessories
          </a>
          <a routerLink="/categories/Home Appliances" class="dropdown-link">
            <svg class="dropdown-icon" width="20" height="20" viewBox="0 0 24 24" fill="none"
              xmlns="http://www.w3.org/2000/svg">
              <rect x="3" y="3" width="18" height="18" rx="2" ry="2" stroke="currentColor" stroke-width="2" />
              <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2" />
              <path d="M12 1V3" stroke="currentColor" stroke-width="2" />
              <path d="M21 12H23" stroke="currentColor" stroke-width="2" />
              <path d="M12 21V23" stroke="currentColor" stroke-width="2" />
              <path d="M1 12H3" stroke="currentColor" stroke-width="2" />
            </svg>
            Home Appliances
          </a>
          <a routerLink="/categories/Gaming" class="dropdown-link">
            <svg class="dropdown-icon" width="20" height="20" viewBox="0 0 24 24" fill="none"
              xmlns="http://www.w3.org/2000/svg">
              <rect x="2" y="6" width="20" height="12" rx="4" ry="4" stroke="currentColor" stroke-width="2" />
              <circle cx="8" cy="12" r="2" stroke="currentColor" stroke-width="2" />
              <path d="M16 10L18 12L16 14" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                stroke-linejoin="round" />
            </svg>
            Gaming
          </a>
          <a routerLink="/categories/Audio & Sound" class="dropdown-link">
            <svg class="dropdown-icon" width="20" height="20" viewBox="0 0 24 24" fill="none"
              xmlns="http://www.w3.org/2000/svg">
              <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5" stroke="currentColor" stroke-width="2" />
              <path d="M19.07 4.93C20.98 6.84 20.98 10.16 19.07 12.07M15.54 8.46C16.17 9.09 16.17 10.09 15.54 10.72"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
            </svg>
            Audio & Sound
          </a>
        </div>
      </div>
      <a routerLink="/deals" class="nav-link">Deals</a>
      <a routerLink="/login" class="nav-link">Signup</a>
      <a routerLink="/profile" class="nav-link">Profile</a>
    </div>
    <div class="cart-icon-container">
      <button class="cart-icon" aria-label="Cart" (click)="goToCart()" title="Cart">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path
            d="M6 2L3 6V20C3 20.5304 3.21071 21.0391 3.58579 21.4142C3.96086 21.7893 4.46957 22 5 22H19C19.5304 22 20.0391 21.7893 20.4142 21.4142C20.7893 21.0391 21 20.5304 21 20V6L18 2H6Z"
            stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
          <path d="M3 6H21" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
          <path
            d="M16 10C16 11.0609 15.5786 12.0783 14.8284 12.8284C14.0783 13.5786 13.0609 14 12 14C10.9391 14 9.92172 13.5786 9.17157 12.8284C8.42143 12.0783 8 11.0609 8 10"
            stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
        </svg>
        <span class="cart-count" *ngIf="cartCount > 0">{{ cartCount }}</span>
      </button>
    </div>
  </nav>
</header>

<main class="shop-container">
  <!-- Hero Section -->
  <section class="hero-banner">
    <div class="hero-content">
      <h1>Discover Tech That Inspires</h1>
      <p>Premium electronics at competitive prices with free delivery in Nairobi for orders over KSh 5,000</p>
      <button class="shop-now-btn" (click)="resetFilters()">Shop Now</button>
    </div>
  </section>

  <!-- Featured Categories -->
  <section class="featured-categories">
    <h2>Shop by Category</h2>
    <div class="categories-grid">
      <div *ngFor="let category of featuredCategories" class="category-card"
        [class.active]="selectedCategory === category.name" (click)="onCategoryClick(category.name)">
        <div class="category-icon">{{category.icon}}</div>
        <h3>{{category.name}}</h3>
        <p>{{category.count}} products</p>
      </div>
    </div>
  </section>

  <!-- Special Offers -->
  <section class="special-offers">
    <h2>Special Offers</h2>
    <div class="offers-container">
      <div *ngFor="let offer of specialOffers" class="offer-card">
        <div class="offer-badge" *ngIf="offer.discount">
          {{offer.discount}}% OFF
        </div>
        <h3>{{offer.title}}</h3>
        <p>{{offer.description}}</p>
        <button class="view-offer-btn">View Offer</button>
      </div>
    </div>
  </section>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-container">
    <div class="loading-spinner"></div>
    <p>Loading products...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="errorMessage && !loading" class="error-container">
    <p>{{errorMessage}}</p>
    <button class="retry-btn" (click)="loadProducts()">Retry</button>
  </div>

  <!-- Products Section -->
  <section class="products-section" *ngIf="!loading && !errorMessage">
    <div class="section-header">
      <h2>Browse Products</h2>
      <div class="controls">
        <div class="results-count">
          Showing {{filteredProducts.length}} of {{allProducts.length}} products
        </div>
        <div class="sort-control">
          <label for="sort">Sort by:</label>
          <select id="sort" [(ngModel)]="sortOption" (change)="applyFilters()">
            <option *ngFor="let option of sortOptions" [value]="option.value">
              {{option.label}}
            </option>
          </select>
        </div>
      </div>
    </div>

    <div class="products-layout">
      <!-- Filters Sidebar -->
      <aside class="filters-sidebar">
        <div class="filter-header">
          <h3>Filters</h3>
          <button class="reset-btn" (click)="resetFilters()">Reset All</button>
        </div>

        <!-- Price Range Filter -->
        <div class="filter-group">
          <h4>Price Range</h4>
          <div class="price-range">
            <div class="price-inputs">
              <input type="number" [(ngModel)]="minPrice" (change)="applyFilters()" placeholder="Min">
              <span>-</span>
              <input type="number" [(ngModel)]="maxPrice" (change)="applyFilters()" placeholder="Max">
            </div>
            <button class="apply-btn" (click)="applyFilters()">Apply</button>
          </div>
          <div class="price-values">
            <span>KSh {{minPrice | number}}</span>
            <span>KSh {{maxPrice | number}}</span>
          </div>
        </div>

        <!-- Category Filter -->
        <div class="filter-group">
          <h4>Category</h4>
          <ul class="filter-list">
            <li *ngFor="let cat of categories">
              <label>
                <input type="radio" name="category" [value]="cat" [(ngModel)]="selectedCategory"
                  (change)="applyFilters()">
                {{cat === 'all' ? 'All Categories' : cat}}
              </label>
            </li>
          </ul>
        </div>

        <!-- Brand Filter -->
        <div class="filter-group">
          <h4>Brand</h4>
          <ul class="filter-list">
            <li *ngFor="let brand of brands">
              <label>
                <input type="radio" name="brand" [value]="brand" [(ngModel)]="selectedBrand" (change)="applyFilters()">
                {{brand === 'all' ? 'All Brands' : brand}}
              </label>
            </li>
          </ul>
        </div>
      </aside>

      <!-- Products Grid - Using Correct Product Card Structure -->
      <div class="products-grid" *ngIf="!loading; else loadingTemplate">
        <div class="product-card" *ngFor="let product of filteredProducts">
          <!-- Product Badges -->
          <div class="product-badges" *ngIf="product.sale_price">
            <div class="discount-badge">
              {{getDiscountPercentage(product)}}% OFF
            </div>
          </div>

          <!-- Product Image -->
          <div class="product-image">
            <img [src]="getProductImage(product)" [alt]="product.title" (error)="onImageError($event)" loading="lazy"
              *ngIf="product.images; else imageLoading">
            <ng-template #imageLoading>
              <div class="image-placeholder">Product Image</div>
            </ng-template>
          </div>

          <!-- Product Info -->
          <div class="product-info">
            <h3 class="product-name">{{ product.title }}</h3>
            <p class="product-specs">{{ getProductSpecs(product) }}</p>

            <!-- Product Rating and Price -->
            <div class="product-rating">
              <div class="stars">
                <span *ngFor="let star of [1,2,3,4,5]" class="star" [class.filled]="star <= product.rating"
                  [class.half]="star === Math.ceil(product.rating) && product.rating % 1 !== 0">
                  â˜…
                </span>
              </div>
              <span class="rating-count">({{ product.review_count }})</span>
            </div>

            <!-- Price -->
            <div class="price-container">
              <span class="original-price" *ngIf="product.sale_price">KSh {{ product.price | number:'1.0-0' }}</span>
              <span class="product-price">KSh {{ getDisplayPrice(product) | number:'1.0-0' }}</span>
            </div>

            <!-- Product Footer -->
            <div class="product-footer">
              <button class="add-to-cart" (click)="addToCart(product)" [disabled]="addingToCart || product.stock < 1">
                {{product.stock < 1 ? 'Out of Stock' : 'Add to Cart' }} </button>
                  <button class="view-details" (click)="viewProductDetails(product)">View Details</button>
            </div>
          </div>
        </div>

        <!-- Empty State -->
        <div *ngIf="filteredProducts.length === 0" class="empty-state">
          <svg width="64" height="64" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <circle cx="12" cy="12" r="10" stroke="#9ca3af" stroke-width="2" />
            <path d="M8 12L12 16L16 12" stroke="#9ca3af" stroke-width="2" stroke-linecap="round"
              stroke-linejoin="round" />
          </svg>
          <h3>No products found</h3>
          <p>Try adjusting your filters or search criteria</p>
        </div>
      </div>

      <!-- Loading Template -->
      <ng-template #loadingTemplate>
        <div class="loading-container">
          <div class="loading-spinner"></div>
          <p>Loading products...</p>
        </div>
      </ng-template>
    </div>
  </section>
</main>

<!-- Footer -->
<footer class="shop-footer">
  <div class="footer-content">
    <div class="footer-section">
      <h3>TechWave Kenya</h3>
      <br>
      <p>Your trusted electronics partner in Nairobi and Meru</p>
      <div class="contact-info">
        <p>Email: techwaveelectronics4&#64;gmail.com</p>
        <p>Phone: +254 742 841406 / +254 741 677623</p>
        <div class="social-icons">
          <a routerLink="https://wa.me/+254742841406" target="_blank"><i class="fa-brands fa-whatsapp"></i></a>
          <a routerLink="https://web.facebook.com/profile.php?id=61577689410885" target="_blank"><i
              class="fa-brands fa-facebook-f"></i></a>
          <a routerLink="http://instagram.com/techwave_.electronics/" target="_blank"><i
              class="fa-brands fa-instagram"></i></a>
          <a routerLink="https://www.tiktok.com/@_.techwave" target="_blank"><i class="fa-brands fa-tiktok"></i></a>
          <a routerLink="https://x.com/_techWave01" target="_blank"><i class="fa-brands fa-x-twitter"></i></a>
        </div>
      </div>
    </div>
    <div class="footer-section">
      <h4>Quick Links</h4>
      <br>
      <ul>
        <li><a routerLink="/">Home</a></li>
        <li><a routerLink="/shop">Shop</a></li>
        <li><a routerLink="/deals">Deals</a></li>
        <li><a routerLink="/contact">Contact Us</a></li>
      </ul>
    </div>
    <div class="footer-section">
      <h4>Delivery Information</h4>
      <br>
      <ul>
        <li>Nairobi: 1-2 business days</li>
        <li>Meru: 2-3 business days</li>
        <li>Other Areas: 3-5 business days</li>
        <li>Free delivery in Nairobi for orders over KSh 5,000</li>
      </ul>
    </div>
    <div class="footer-section">
      <h4>We Accept</h4>
      <br>
      <div class="payment-methods">
        <div class="payment-method">M-PESA</div>
        <div class="payment-method">VISA</div>
        <div class="payment-method">MasterCard</div>
      </div>
    </div>
  </div>
  <div class="copyright">
    &copy; 2025 TechWave Kenya. All rights reserved.
  </div>
</footer>